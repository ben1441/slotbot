"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateWebAppData = exports.checkSignature = void 0;
const deps_node_js_1 = require("./deps.node.js");
function checkSignature(token, { hash, ...data }) {
    const secretKey = (0, deps_node_js_1.sha256)(token);
    return compareHmac(secretKey, hash, data);
}
exports.checkSignature = checkSignature;
function validateWebAppData(token, initData) {
    const secretKey = (0, deps_node_js_1.hmacSha256)("WebAppData", token);
    const { hash, ...data } = Object.fromEntries(initData.entries());
    return compareHmac(secretKey, hash, data);
}
exports.validateWebAppData = validateWebAppData;
function compareHmac(secretKey, hash, data) {
    const dataCheckString = Object.keys(data)
        .sort()
        .map((k) => `${k}=${data[k]}`)
        .join("\n");
    return hash === (0, deps_node_js_1.hmacSha256Hex)(secretKey, dataCheckString);
}
